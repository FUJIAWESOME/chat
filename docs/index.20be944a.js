let e;function t(e,t,n,o){Object.defineProperty(e,t,{get:n,set:o,enumerable:!0,configurable:!0})}function n(e){return e&&e.__esModule?e.default:e}var o=globalThis,r={},a={},s=o.parcelRequire25d8;null==s&&((s=function(e){if(e in r)return r[e].exports;if(e in a){var t=a[e];delete a[e];var n={id:e,exports:{}};return r[e]=n,t.call(n.exports,n,n.exports),n.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){a[e]=t},o.parcelRequire25d8=s);var l=s.register;l("8Nbse",function(e,t){e.exports,e.exports=function(){/* eslint-disable no-var */function e(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)e[o]=n[o]}return e}/* eslint-enable no-var */return /* eslint-enable no-var *//* eslint-disable no-var */function t(n,o){function r(t,r,a){if("undefined"!=typeof document){"number"==typeof(a=e({},o,a)).expires&&(a.expires=new Date(Date.now()+864e5*a.expires)),a.expires&&(a.expires=a.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var l in a)a[l]&&(s+="; "+l,!0!==a[l]&&// Considers RFC 6265 section 5.2:
// ...
// 3.  If the remaining unparsed-attributes contains a %x3B (";")
//     character:
// Consume the characters of the unparsed-attributes up to,
// not including, the first %x3B (";") character.
// ...
(s+="="+a[l].split(";")[0]));return document.cookie=t+"="+n.write(r,t)+s}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],o={},r=0;r<t.length;r++){var a=t[r].split("="),s=a.slice(1).join("=");try{var l=decodeURIComponent(a[0]);if(o[l]=n.read(s,l),e===l)break}catch(e){}}return e?o[e]:o}},remove:function(t,n){r(t,"",e({},n,{expires:-1}))},withAttributes:function(n){return t(this.converter,e({},this.attributes,n))},withConverter:function(n){return t(e({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(o)},converter:{value:Object.freeze(n)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()}),l("s9t2A",function(e,n){t(e.exports,"UI_ELEMENTS",()=>o),t(e.exports,"URL",()=>r),t(e.exports,"HTTP",()=>a),t(e.exports,"WS_READY_STATE",()=>s);let o={FORM:{AUTHORIZATION:document.querySelector(".authorization__form"),SETTINGS:document.querySelector(".settings__form"),ACCEPT:document.querySelector(".accept__form"),INPUT_MESSAGE:document.querySelector(".dialog__bottom")},MODAL_WINDOW:{AUTHORIZATION:document.querySelector(".authorization"),SETTINGS:document.querySelector(".settings"),ACCEPT:document.querySelector(".accept")},BUTTON:{AUTHORIZATION_TOKEN_BTN:document.querySelector(".authorization__token-btn"),ACCEPT_CLOSE:document.querySelector(".accept__close"),SETTINGS_CLOSE:document.querySelector(".settings__close"),SETTINGS:document.querySelector(".dialog__btn-settings"),EXIT:document.querySelector(".dialog__btn-exit")},BACKGROUND_MODAL_WINDOW:document.querySelector(".background-modal_window"),TEMPLATE:document.getElementById("message_submit"),MESSAGE_LIST:document.querySelector(".dialog__message-list")},r={API:{MESSAGES:"https://edu.strada.one/api/messages",USER:"https://edu.strada.one/api/user",USER_ME:"https://edu.strada.one/api/user/me"},WEB_SOCKET:"ws://edu.strada.one/websockets?"},a={STATUS:{BAD_REQUEST:400,UNAUTHORIZED:401}},s={OPEN:1,CLOSED:3}});var i=s("8Nbse"),E=s("s9t2A"),i=s("8Nbse"),E=s("s9t2A");async function c(e,t,n,o){let r={method:t,headers:o};try{let e=Object.keys(n).length;e&&(r.body=JSON.stringify(n))}catch(e){console.log(e)}return await fetch(e,r)}function u(e){let t={Authorization:`Bearer ${e}`,"Content-Type":"application/json"};return c(E.URL.API.MESSAGES,"GET",{},t)}function T(){e.onmessage=function(e){try{let t=JSON.parse(e.data),n=new Date(t.createdAt),o=localStorage.getItem("email");t.user.email===o?S(t.user.name,t.text,n,!0,!0):S(t.user.name,t.text,n,!1,!0)}catch(e){console.log(e)}}}function d(){try{let t=/*@__PURE__*/n(i).get("token"),o=e?.readyState===E.WS_READY_STATE.OPEN,r=e?.readyState===E.WS_READY_STATE.CLOSED||!e;o?(e.close(),e=new WebSocket(E.URL.WEB_SOCKET+t),T()):r&&(e=new WebSocket(E.URL.WEB_SOCKET+t),T())}catch(e){console.log(e)}}function S(e,t,n,o,r){let a=n.getHours(),s=10>n.getMinutes()?"0"+n.getMinutes():n.getMinutes(),l=document.createElement("li");l.append((0,E.UI_ELEMENTS).TEMPLATE.content.cloneNode(!0)),l.firstElementChild.textContent=`${e}: ${t}`,l.lastElementChild.textContent=`${a}:${s}`,l.classList.add("dialog__message","dialog__message-box",o?"dialog__personal_message":"dialog__someone_message"),r?(0,E.UI_ELEMENTS).MESSAGE_LIST.prepend(l):(0,E.UI_ELEMENTS).MESSAGE_LIST.append(l)}async function _(){let e=localStorage.getItem("numberUploadedMessages");//  
localStorage.setItem("numberUploadedMessages",Number(localStorage.getItem("numberUploadedMessages"))+19);let t=localStorage.getItem("numberUploadedMessages");try{let n=JSON.parse(localStorage.getItem("messages"));n.messages.forEach((n,o)=>{if(o>=e&&o<t){let e=new Date(n.createdAt),t=localStorage.getItem("email");n.user.email===t?S(n.user.name,n.text,e,!0,!1):S(n.user.name,n.text,e,!1,!1)}})}catch(e){console.log(e)}}document.addEventListener("DOMContentLoaded",async()=>{localStorage.setItem("numberUploadedMessages",0);let e=/*@__PURE__*/n(i).get("token");if(e){let t=await u(e),n=await t.json();try{localStorage.setItem("messages",JSON.stringify(n))}catch(e){console.log(e)}_(),d()}else(0,E.UI_ELEMENTS).MODAL_WINDOW.AUTHORIZATION.classList.add("open"),E.UI_ELEMENTS.BACKGROUND_MODAL_WINDOW.style.display="block"}),(0,E.UI_ELEMENTS).MESSAGE_LIST.addEventListener("scroll",e=>{let t=e.currentTarget.clientHeight,n=e.currentTarget.scrollHeight,o=e.currentTarget.scrollTop;t+Math.abs(o)+1>=n&&_()}),(0,E.UI_ELEMENTS).BUTTON.SETTINGS.addEventListener("click",async()=>{(0,E.UI_ELEMENTS).MODAL_WINDOW.SETTINGS.classList.add("open"),E.UI_ELEMENTS.BACKGROUND_MODAL_WINDOW.style.display="block",E.UI_ELEMENTS.FORM.SETTINGS.firstElementChild.value=localStorage.getItem("name")}),(0,E.UI_ELEMENTS).FORM.INPUT_MESSAGE.addEventListener("submit",t=>{t.preventDefault();let n=t.target.firstElementChild.value;if(t.target.firstElementChild.value="",!n){alert("Нелья отправить пустое сообщение!");return}!function(t){try{e?.readyState===1&&e.send(JSON.stringify({text:`${t}`}))}catch(e){console.log(e)}}(n)}),(0,E.UI_ELEMENTS).FORM.SETTINGS.addEventListener("submit",async e=>{e.preventDefault();let t=e.target.firstElementChild.value,o=await function(e){let t=/*@__PURE__*/n(i).get("token"),o={Authorization:`Bearer ${t}`,"Content-Type":"application/json"};return c(E.URL.API.USER,"PATCH",{name:e},o)}(t);if(o.status===E.HTTP.STATUS.BAD_REQUEST){alert("Имя слишком короткое! Минимум два символа!");return}// const data = await response.json();
// console.log(data);
localStorage.setItem("name",t),alert("Имя успешно изменино!")}),(0,E.UI_ELEMENTS).FORM.AUTHORIZATION.addEventListener("submit",async e=>{e.preventDefault();let t=e.target.firstElementChild.value,n=await c(E.URL.API.USER,"POST",{email:t},{"Content-Type":"application/json"});if(n.status===E.HTTP.STATUS.BAD_REQUEST){alert("Введен некорректный адрес эл. почты!");return}alert("На почту отправлен код подтверждения!"),(0,E.UI_ELEMENTS).MODAL_WINDOW.AUTHORIZATION.classList.remove("open"),(0,E.UI_ELEMENTS).MODAL_WINDOW.ACCEPT.classList.add("open")}),(0,E.UI_ELEMENTS).FORM.ACCEPT.addEventListener("submit",async e=>{e.preventDefault();let t=e.target.firstElementChild.value,o=await u(t);if(o.status===E.HTTP.STATUS.UNAUTHORIZED){alert("Неверный код подтверждения!");return}let r=await o.json();try{localStorage.setItem("messages",JSON.stringify(r))}catch(e){console.log(e)}/*@__PURE__*/n(i).set("token",t);let a=await function(){let e=/*@__PURE__*/n(i).get("token"),t={Authorization:`Bearer ${e}`,"Content-Type":"application/json"};return c(E.URL.API.USER_ME,"GET",{},t)}(),s=await a.json();localStorage.setItem("email",s.email),localStorage.setItem("name",s.name),_(),d(),(0,E.UI_ELEMENTS).MODAL_WINDOW.ACCEPT.classList.remove("open"),E.UI_ELEMENTS.BACKGROUND_MODAL_WINDOW.style.display="none",e.target.firstElementChild.value=""}),(0,E.UI_ELEMENTS).BUTTON.ACCEPT_CLOSE.addEventListener("click",()=>{(0,E.UI_ELEMENTS).MODAL_WINDOW.ACCEPT.classList.remove("open"),(0,E.UI_ELEMENTS).MODAL_WINDOW.AUTHORIZATION.classList.add("open")}),(0,E.UI_ELEMENTS).BUTTON.SETTINGS_CLOSE.addEventListener("click",()=>{(0,E.UI_ELEMENTS).MODAL_WINDOW.SETTINGS.classList.remove("open"),E.UI_ELEMENTS.BACKGROUND_MODAL_WINDOW.style.display="none"}),(0,E.UI_ELEMENTS).BUTTON.AUTHORIZATION_TOKEN_BTN.addEventListener("click",()=>{(0,E.UI_ELEMENTS).MODAL_WINDOW.AUTHORIZATION.classList.remove("open"),(0,E.UI_ELEMENTS).MODAL_WINDOW.ACCEPT.classList.add("open")}),(0,E.UI_ELEMENTS).BUTTON.EXIT.addEventListener("click",()=>{/*@__PURE__*/n(i).remove("token"),localStorage.clear(),localStorage.setItem("numberUploadedMessages",0),I(),(0,E.UI_ELEMENTS).MODAL_WINDOW.AUTHORIZATION.classList.add("open"),E.UI_ELEMENTS.BACKGROUND_MODAL_WINDOW.style.display="block"});const I=()=>{let e=document.querySelectorAll(".dialog__message");e&&e.forEach(e=>e.remove())};//# sourceMappingURL=index.20be944a.js.map

//# sourceMappingURL=index.20be944a.js.map
